<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web UI Management - iptables & Routing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div x-data="webUIManagement()" x-init="init()">
        <!-- Header -->
        <header x-show="isAuthenticated" class="fixed top-0 left-0 right-0 z-50 bg-white/10 backdrop-blur-lg border-b border-white/20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-3">
                    <div class="flex items-center">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-lg font-bold text-white">Web UI Management</h1>
                                <span class="text-blue-100 text-xs">Firewall & Routing Control Panel</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div x-show="isAuthenticated" class="flex items-center space-x-2">
                            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20">
                                <div class="flex items-center space-x-2">
                                    <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                        <svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <span class="text-white font-medium text-sm" x-text="loginForm.username"></span>
                                        <div class="text-blue-100 text-xs">Admin</div>
                                    </div>
                                    <button @click="logout()" 
                                            class="px-3 py-1 bg-red-500 text-white rounded text-xs font-semibold hover:bg-red-600 transition-all duration-200">
                                        Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button @click="refreshData()" 
                                    class="px-2 py-1 bg-white/20 text-white rounded text-xs hover:bg-white/30 transition-all duration-200">
                                üîÑ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="fixed inset-0 pt-20 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 overflow-y-auto">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Login Screen (when not authenticated) -->
            <div x-show="!isAuthenticated" class="fixed inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center overflow-hidden">
                <!-- Background Pattern -->
                <div class="absolute inset-0 opacity-10">
                    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-blue-500/20 to-purple-500/20"></div>
                    <div class="absolute top-20 left-20 w-32 h-32 bg-blue-500/10 rounded-full blur-xl"></div>
                    <div class="absolute bottom-20 right-20 w-40 h-40 bg-purple-500/10 rounded-full blur-xl"></div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-60 h-60 bg-orange-500/5 rounded-full blur-2xl"></div>
                </div>
                
                <!-- Main Login Container -->
                <div class="relative z-10 w-full max-w-7xl mx-auto px-8">
                    <div class="flex items-start justify-start min-h-screen pl-16 pt-20">
                        <div class="flex items-start space-x-16">
                            <!-- Left Side - Login Form -->
                            <div class="w-96">
                                <div class="bg-white rounded-2xl p-8 shadow-2xl">
                                    <!-- Header -->
                                    <div class="text-center mb-8">
                                        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center shadow-xl">
                                            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 0 0112 2.944a11.955 0 01-8.618 3.04A12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                            </svg>
                                        </div>
                                        <h1 class="text-2xl font-bold text-gray-800 mb-2">Web UI Management</h1>
                                        <p class="text-gray-600">Firewall & Routing Control</p>
                                    </div>
                                    
                                    <form @submit.prevent="login()" class="space-y-6">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                            <input x-model="loginForm.username" type="text" required 
                                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                                                   placeholder="Enter your username">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                            <input x-model="loginForm.password" type="password" required 
                                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                                                   placeholder="Enter your password">
                                        </div>
                                        
                                        <div class="flex items-center justify-between">
                                            <label class="flex items-center">
                                                <input type="checkbox" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                                <span class="ml-2 text-sm text-gray-600">Remember me</span>
                                            </label>
                                            <a href="#" class="text-sm text-blue-600 hover:text-blue-500">Forgot password?</a>
                                        </div>
                                        
                                        <button type="submit" 
                                                class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl">
                                            üîê Sign In
                                        </button>
                                    </form>
                                    
                                    <div class="mt-6 text-center">
                                        <div class="text-xs text-gray-500 mb-2">Default credentials:</div>
                                        <div class="text-xs text-gray-600">
                                            <span class="bg-gray-100 px-2 py-1 rounded">admin</span> / 
                                            <span class="bg-gray-100 px-2 py-1 rounded">admin123</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Side - Ubuntu Logo -->
                            <div class="flex flex-col items-center">
                                <div class="w-48 h-24 bg-white rounded-2xl mb-6 flex items-center justify-center shadow-2xl p-3">
                                    <!-- Ubuntu Logo from PNG file -->
                                    <img src="/static/assets/ubuntu-logo.png" alt="Ubuntu Logo" class="w-full h-full object-contain">
                                </div>
                                <h1 class="text-3xl font-bold text-white mb-2">Ubuntu</h1>
                                <p class="text-gray-300 text-lg">Linux Distribution</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Info -->
            <div x-show="isAuthenticated" class="mb-8">
                <div class="bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-600">
                    <div class="flex items-center mb-6">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h2 class="text-xl font-semibold text-white">System Information</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="text-center p-6 bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl border border-gray-600 hover:shadow-md transition-all duration-200">
                            <div class="w-12 h-12 bg-blue-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 4a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1V8zm8 0a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zm0 4a1 1 0 011-1h4a1 1 0 011 1v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-blue-400 mb-1" x-text="systemInfo.hostname || 'N/A'"></div>
                            <div class="text-sm text-gray-300">Hostname</div>
                        </div>
                        <div class="text-center p-6 bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl border border-gray-600 hover:shadow-md transition-all duration-200">
                            <div class="w-12 h-12 bg-green-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-green-400 mb-1" x-text="systemInfo.rules_count || 0"></div>
                            <div class="text-sm text-gray-300">Firewall Rules</div>
                        </div>
                        <div class="text-center p-6 bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl border border-gray-600 hover:shadow-md transition-all duration-200">
                            <div class="w-12 h-12 bg-purple-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold text-purple-400 mb-1" x-text="systemInfo.routes_count || 0"></div>
                            <div class="text-sm text-gray-300">Routes</div>
                        </div>
                        <div class="text-center p-6 bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl border border-gray-600 hover:shadow-md transition-all duration-200">
                            <div class="w-12 h-12 bg-orange-500 rounded-full mx-auto mb-3 flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="text-sm font-bold text-orange-400 mb-1" x-text="systemInfo.uptime || 'N/A'"></div>
                            <div class="text-sm text-gray-300">Uptime</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div x-show="isAuthenticated" class="mb-6">
                <div class="border-b border-gray-600">
                    <nav class="-mb-px flex space-x-8">
                        <button @click="activeTab = 'firewall'" 
                                :class="activeTab === 'firewall' ? 'border-blue-500 text-blue-400 bg-gray-700' : 'border-transparent text-white hover:text-gray-300 hover:border-gray-500 bg-gray-800'"
                                class="whitespace-nowrap py-2 px-4 border-b-2 font-medium text-sm rounded-t-lg transition-all duration-200">
                            Firewall Rules
                        </button>
                        <button @click="activeTab = 'routing'" 
                                :class="activeTab === 'routing' ? 'border-blue-500 text-blue-400 bg-gray-700' : 'border-transparent text-white hover:text-gray-300 hover:border-gray-500 bg-gray-800'"
                                class="whitespace-nowrap py-2 px-4 border-b-2 font-medium text-sm rounded-t-lg transition-all duration-200">
                            Routing Table
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Firewall Rules Tab -->
            <div x-show="isAuthenticated && activeTab === 'firewall'" class="fade-in">
                <div class="bg-gray-800 rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-600">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-white">Firewall Rules</h2>
                            <button @click="showAddFirewallModal = true" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Add Rule
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Chain</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Protocol</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Source</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Destination</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Port</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Action</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-gray-800 divide-y divide-gray-600">
                                <template x-for="rule in firewallRules" :key="rule.id">
                                    <tr class="hover:bg-gray-700">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="rule.id"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="rule.chain"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="rule.protocol || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="rule.source || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="rule.destination || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="rule.port || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="rule.action === 'ACCEPT' ? 'bg-green-600 text-green-100' : rule.action === 'DROP' ? 'bg-red-600 text-red-100' : 'bg-gray-600 text-gray-100'"
                                                  class="px-2 py-1 text-xs font-medium rounded-full" x-text="rule.action"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="deleteFirewallRule(rule.id)" 
                                                    class="text-red-400 hover:text-red-300">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Routing Table Tab -->
            <div x-show="isAuthenticated && activeTab === 'routing'" class="fade-in">
                <div class="bg-gray-800 rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-600">
                        <div class="flex justify-between items-center">
                            <h2 class="text-lg font-semibold text-white">Routing Table</h2>
                            <button @click="showAddRouteModal = true" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                Add Route
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Network</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Gateway</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Interface</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Metric</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-gray-800 divide-y divide-gray-600">
                                <template x-for="route in routes" :key="route.id">
                                    <tr class="hover:bg-gray-700">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="route.id"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="route.network"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="route.gateway || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="route.interface || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-white" x-text="route.metric || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="deleteRoute(route.id)" 
                                                    class="text-red-400 hover:text-red-300">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Add Firewall Rule Modal -->
            <div x-show="showAddFirewallModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Add Firewall Rule</h3>
                        <form @submit.prevent="addFirewallRule()">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Table</label>
                                    <select x-model="newFirewallRule.table" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                        <option value="filter">filter</option>
                                        <option value="nat">nat</option>
                                        <option value="mangle">mangle</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Chain</label>
                                    <input x-model="newFirewallRule.chain" type="text" required 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Protocol</label>
                                    <select x-model="newFirewallRule.protocol" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                        <option value="">Any</option>
                                        <option value="tcp">TCP</option>
                                        <option value="udp">UDP</option>
                                        <option value="icmp">ICMP</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Source</label>
                                    <input x-model="newFirewallRule.source" type="text" placeholder="e.g., 192.168.1.0/24" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Destination</label>
                                    <input x-model="newFirewallRule.destination" type="text" placeholder="e.g., 10.0.0.0/8" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Port</label>
                                    <input x-model="newFirewallRule.port" type="text" placeholder="e.g., 80,443" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Action</label>
                                    <select x-model="newFirewallRule.action" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                        <option value="ACCEPT">ACCEPT</option>
                                        <option value="DROP">DROP</option>
                                        <option value="REJECT">REJECT</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Comment</label>
                                    <input x-model="newFirewallRule.comment" type="text" placeholder="Optional comment" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" @click="showAddFirewallModal = false" 
                                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    Add Rule
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Add Route Modal -->
            <div x-show="showAddRouteModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                    <div class="mt-3">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Add Route</h3>
                        <form @submit.prevent="addRoute()">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Network</label>
                                    <input x-model="newRoute.network" type="text" required placeholder="e.g., 192.168.1.0/24" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Gateway</label>
                                    <input x-model="newRoute.gateway" type="text" placeholder="e.g., 192.168.1.1" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Interface</label>
                                    <input x-model="newRoute.interface" type="text" placeholder="e.g., eth0" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Metric</label>
                                    <input x-model="newRoute.metric" type="number" placeholder="e.g., 100" 
                                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                </div>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" @click="showAddRouteModal = false" 
                                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                                    Cancel
                                </button>
                                <button type="submit" 
                                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    Add Route
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div x-show="notification.show" x-transition class="fixed bottom-4 right-4 z-[100]">
                <div :class="notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'" 
                     class="text-white px-6 py-3 rounded-lg shadow-lg backdrop-blur-sm border border-white/20">
                    <span x-text="notification.message"></span>
                </div>
            </div>
            </div>
        </main>
    </div>

    <script>
        function webUIManagement() {
            return {
                isAuthenticated: false,
                activeTab: 'firewall',
                token: '',
                
                // Forms
                loginForm: {
                    username: 'admin',
                    password: 'admin123'
                },
                
                newFirewallRule: {
                    table: 'filter',
                    chain: 'INPUT',
                    protocol: '',
                    source: '',
                    destination: '',
                    port: '',
                    action: 'ACCEPT',
                    comment: ''
                },
                
                newRoute: {
                    network: '',
                    gateway: '',
                    interface: '',
                    metric: ''
                },
                
                // Data
                firewallRules: [],
                routes: [],
                systemInfo: {},
                
                // UI State
                showAddFirewallModal: false,
                showAddRouteModal: false,
                notification: {
                    show: false,
                    type: 'success',
                    message: ''
                },
                
                init() {
                    this.checkAuth();
                    if (this.isAuthenticated) {
                        this.loadData();
                    }
                },
                
                checkAuth() {
                    const token = localStorage.getItem('token');
                    if (token) {
                        this.token = token;
                        this.isAuthenticated = true;
                    }
                },
                
                async login() {
                    try {
                        const response = await fetch('/api/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.loginForm)
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.token = data.token;
                            this.isAuthenticated = true;
                            localStorage.setItem('token', this.token);
                            this.showNotification('Login successful', 'success');
                            this.loadData();
                        } else {
                            this.showNotification(data.error || 'Login failed', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Network error', 'error');
                    }
                },
                
                logout() {
                    this.token = '';
                    this.isAuthenticated = false;
                    localStorage.removeItem('token');
                    this.showNotification('Logged out', 'success');
                },
                
                async loadData() {
                    if (!this.isAuthenticated) return;
                    
                    try {
                        await Promise.all([
                            this.loadFirewallRules(),
                            this.loadRoutes(),
                            this.loadSystemInfo()
                        ]);
                    } catch (error) {
                        this.showNotification('Failed to load data', 'error');
                    }
                },
                
                async loadFirewallRules() {
                    const response = await fetch('/api/firewall/rules', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.firewallRules = data.rules;
                    }
                },
                
                async loadRoutes() {
                    const response = await fetch('/api/routes', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.routes = data.routes;
                    }
                },
                
                async loadSystemInfo() {
                    const response = await fetch('/api/system/info', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        this.systemInfo = data;
                    }
                },
                
                async addFirewallRule() {
                    try {
                        const response = await fetch('/api/firewall/rules', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify(this.newFirewallRule)
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.showNotification('Firewall rule added successfully', 'success');
                            this.showAddFirewallModal = false;
                            this.resetFirewallForm();
                            this.loadFirewallRules();
                        } else {
                            this.showNotification(data.error || 'Failed to add rule', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Network error', 'error');
                    }
                },
                
                async deleteFirewallRule(id) {
                    if (!confirm('Are you sure you want to delete this rule?')) return;
                    
                    try {
                        const response = await fetch(`/api/firewall/rules/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${this.token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.showNotification('Firewall rule deleted successfully', 'success');
                            this.loadFirewallRules();
                        } else {
                            this.showNotification(data.error || 'Failed to delete rule', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Network error', 'error');
                    }
                },
                
                async addRoute() {
                    try {
                        const response = await fetch('/api/routes', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify(this.newRoute)
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.showNotification('Route added successfully', 'success');
                            this.showAddRouteModal = false;
                            this.resetRouteForm();
                            this.loadRoutes();
                        } else {
                            this.showNotification(data.error || 'Failed to add route', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Network error', 'error');
                    }
                },
                
                async deleteRoute(id) {
                    if (!confirm('Are you sure you want to delete this route?')) return;
                    
                    try {
                        const response = await fetch(`/api/routes/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${this.token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.showNotification('Route deleted successfully', 'success');
                            this.loadRoutes();
                        } else {
                            this.showNotification(data.error || 'Failed to delete route', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Network error', 'error');
                    }
                },
                
                refreshData() {
                    this.loadData();
                    this.showNotification('Data refreshed', 'success');
                },
                
                resetFirewallForm() {
                    this.newFirewallRule = {
                        table: 'filter',
                        chain: 'INPUT',
                        protocol: '',
                        source: '',
                        destination: '',
                        port: '',
                        action: 'ACCEPT',
                        comment: ''
                    };
                },
                
                resetRouteForm() {
                    this.newRoute = {
                        network: '',
                        gateway: '',
                        interface: '',
                        metric: ''
                    };
                },
                
                showNotification(message, type = 'success') {
                    this.notification = {
                        show: true,
                        type: type,
                        message: message
                    };
                    
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
